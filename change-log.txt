/* SmartTemplates older version history - before 3.0 */
  Version History  (chronological)
  This was moved from smartTempalte-main.js
  
  Version 0.7.4 - Released 09/08/2011
	  # Supports: Tb 1.5 - 8.0a1
	  # Originally the X:=sent switch would change all variables after it's use for the remainder of the template unless X:=today was used 
		  to switch them back. That behavior is now changed such that the X:=sent command only affects the line on which it is being used.
		# %datelocal%, %dateshort%, %date_tz% are now affected by the X:=sent and X:=today variables.
		# fix CC line inner Brackets
				
  Version 0.7.5 - Released 28/08/2011
		# Supports: 1.5 - 8.0a1
    # Some users reported subject lines not being displayed correctly. Specifically there were line breaks causing the subject to span more than one line. This could also occur with other  headers but subject was the only one reported.
    # corrected issue where headers longer than 4096 were being truncated.
    # An option was added in settings called "Use OS date/time format instead of Thunderbird".
          Some users reported that SmartTemplates was not using the custom date format they had set in their operating system.
    # updated all helpfiles 'added recent changes'
    # implemented some coding changes suggested by the Mozilla AMO review team.
		
  Version 0.7.6 - Released 09/09/2011
		# Supports: Tb 1.5 - 8.0a1
    # Fixed issue if %datelocal% variable is used for new messages
    # a lot of small fixes
    # changes in locale pt-BR
    
  Version 0.7.7 - Released 04/11/2011
	  # Supports: Tb 1.5 - 10.0a1
    # where reply header was being put above the signature when signature is placed 'above the quote'.
    # automatically add line break in message compose window
    # %date_tz% variable was returning the local timezone instead of the senders timezone.
    # removed the 'automatically add two line breaks' that was added in 0.7.6. This affected many users and the correct way to add line breaks at the top of your message is to include them in your template.
  
  Version 0.7.8 - Released 04/11/2011
	  # Supports: Tb 1.5 - 10.0a1
		#  paste an list of all variables and in which case they can be used to all help files.
    #  SmartTemplates no longer crashes when variables are used incorrectly; an error is logged to the Error Console.
    # added a new variable %sig% to allow users to put their signature where it should be placed in the template. If %sig% is not defined in the template it will be placed in the default Thunderbird location (above reply or below reply based on TB settings). 'Include Signature on Reply/Forward" must be checked in Thunderbird options for the %sig% to work as expected.
    # added a new option to variable %subject% to show the subject of the message being replied to/forwarded or the subject of the current message being composed
    # %tz_name% variable has been added but it is system dependent and will have limited support. Some users will see abbreviated time zone names (EST, CDT) and some will see long names(Eastern Standard Time...) and some will not have any return depending on their operating system or the mailserver of the email being replied to.
    
	Version 0.7.9 - Released 24/12/2011
	  # Supports: Tb 1.5 - 12.0a1
		# corrected incorrect file encodings on many locale files. Incorrectly encoded errors.properties files caused ST4 to crash this has also been corrected.

  Version 0.8.0 - Released 02/02/2012
	  # Supports: Tb 1.5 - 12.0a1
		#  fixed bug where a quotation that is edited loses its formatting or disappears.
    #  made account list in option window easier to read
    #  some visual improvements to the help file
		
	Version 0.8.5.6 - Released 18/06/2012
	  # Supports: Tb 3.1.7 - 14*
		# Fixed compatibility Problem with Thunderbird 13.* which broke a lot of the extension's functionality in 0.8.0 and previous
		# Redesigned Help Window
    # Added inserting variables/keywords using mouse click
    # Added validation during insert (if variable cannot be used in "Write New" it will be rejected
    # Added fi locale
    # Most locales are reviewed and corrected (currently not all) incomplete translations are in English, as always. Many thanks to the translation team at BabelZilla!

  Version 0.9.1 - Released 16/08/2012
	  # Supports: Tb 3.1.7 - 14.*
    # Integrated variables help into options dialog
		# Statusbar button for quickly accessing template settings
		# Added Bugzilla support
		# When switching between accounts, the current Tab (e.g. Reply to) remains selected
    # When updating from an earlier versions, all settings and templates should be migrated automatically, Conversion Wizard
    # Fixed [Bug 24997] "Edit as New" Sometimes Loses Message Body
    # Fixed [Bug 25002] Signature will displayed two times
    # Fixed [Bug 24988] Message body not included replying to "plain-text" messages
    # Fixed [Bug 24991] Replace default quote header not working in some cases
		
  Version 0.9.2 - Released 22/11/2012
	  # Supports: Tb 3.1.7 - 17.* ,  Sm 2.0.0 - 2.16.*
    # Redesigned Settings Window to support signature settings from Thunderbird even better
		# Added support for Seamonkey
		# Added global settings in advanced options pane; includes new font size setting for template editor.
		# [Bug 25088] add option to hide status icon. Configuration setting extensions.smartTemplate4.statusIconLabelMode
		              0 - never show label
									1 - expand label on hover (default)
									2 - always show label
    # Redesigned About Window (Add-On Manager &#8658; rightclick on SmartTemplates &#8658; About)
		# Added uk-UA locale
		# Fixed Bug 25103]	0.9.1 inserts unwanted line break top of &lt;body&gt; in html mode
		# [Bug 25099] Support bottom reply with headers on top
		# [Bug 25097] Forward text message results in double header
    # [Bug 25095] 2 blank lines in plain text between header and quote
    # [Bug 25093] Signatur missing when replying below quote
    # [Bug 25092] Option window broken in Italian version
    # [Bug 25084] 0.9.1 regression: blank line is added before Reply template
    # [Bug 25089] Default forward quote can't be completely hidden - thanks to PeterM for providing a solution
    # [Bug 25117] Plaintext: Template always below the quoted message when replying
    # [Bug 25155] 0.9.1 regression - blank line is added AFTER Reply template
      	
  Version 0.9.3 - 31/07/2013
	  # toolbar button
		# fixed a problem with preference not updating (found by AMO reviewer Nils Maier)
	  # [FR 24990] Added %cursor% variable
		# [FR 25083] New option "Correct Lastname, Firstname" to swap firstname to the front. 
		# %deleteText()% and %replaceText()% functions
		# [FR 25248] Added %y% for two digit years
	  # parsing of variables in Signature - enable extensions.smartTemplate4.parseSignature
	  # Postbox support
		# stabilised signature code base
		# Added Stationery 0.8 support - works with the new event model of Stationery 0.8 - 
			template inserting is disabled if a Stationery Template of 0.7.8 or older is used
		# mailto link support for the main header fields that hold email address data: %to(mail,link)% %to(name,link)%$ %to(firstname,link)%  etc.
		# new %identity()%  function
		# added 24px icon
		# added change log
		# fix: redefinition of Thunderbird's nsIMsgAccount interface broke account dropdown in settings
		# suppressed displaying string conversion prompt when clicking on the version number in advanced options
		# added preferences textbox for default charset
		# [Bug 25483] when using %sig(2)% (option for removing dashes) - signature is missing on new mails in HTML mode 
		# [Bug 25104] when switching identity, old sig does not get removed.
		# [Bug 25486] attaching a plain text file as signature leads to double spaces in signature
		# [Bug 25272] reply below quote with signature placed cursor below signature (should be above signature and below quote)
		# added configuration setting for signature file character set. extensions.smartTemplate4.signature.encoding
		# added configuration setting adding dashes before text sig. extensions.smartTemplate4.signature.insertDashes.plaintext
		# fixed signature position when replying on top (must be below template)
		# hidden settings for adding --<br> before sig (html + plaintext separate).
		# added warning if originalMsgURI cannot be determined
		# added hidden UI on right-click on 'Process signature' option to manage signature settings

  Version 0.9.4 - 15/09/2013 
	  # Fixed [Bug 25523] Cannot use image as signature
		# Fixed [Bug 25526] if no Signature is defined, %sig% is not removed
		# Fixed: Background images in new / reply / forward tabs did not show up in groupbox on default theme in Windows
		# test option for not loading / showing examples tab
		# Reopened and Fixed [Bug 25088] by making status bar icon status more resilient
		# Fixed %subject% removing expressions in <brackets>
		
  Version 0.9.5 -	21/04/2014
	  # improved locale matching (allow matching en as en-US etc.)
		# [Bug 25571]  "replace line breaks with <br>" on when not enabled
		# Make sure that debug settings window stays on top
		# added UI for disabling space for %cursor%
    # Advanced Tab in options dialog
		# [Bug 25676] JavaScript parser added by Benito van der Zander
		# [Bug 25710] <div id=smartTemplate4-template> is inserted in Stationery body
    # [Bug 25643] Display Names from Address book
    # option: Capitalize Names
    # option: Nickname instead of First
    # Improved parsing of timezone string (remove brackets)
    # Fixed [Bug 25191] conflict with add-on Account Colors
    # Fixed a problem with name matching signature files - 
      depending on file name some textual signatures might be accidentally treated as images.
    # Fixed reading plain text signature files (linefeeds where lost) by inserting html line breaks
      to disable this behavior toggle extensions.smartTemplate4.signature.replaceLF.plaintext.br in about:config

  Version 0.9.5.1 - 24/04/2014
    # Fixed minver for SeaMonkey

  Version 0.9.5.2 - 08/05/2014
    # Fixed [Bug 25762] related to Replace Names from Addressbook (LDAP). Also disabled this feature on Postbox.
    
  Version 0.9.6 - 04/10/2014
    # Added a switch for removing emails when replacing Names from Address book
    # Added format %sig(none)% to completely suppress signature
    # [Bug 25089] (reopened) default quote header wasn't removed anymore in Tb 31.0
    # [Bug 25816] Missing names in reply caused by different Encodings - the Mime decoder fails when multiple addresses with varying encodings are contained
    # [Bug 25089] Default forward quote not hidden
    # variable %matchTextFromBody()% to find and replace pattern e.g. %matchTextFromBody(TEST *)% will retrieve '123' from 'TEST 123'
    
  Version 1.0 - 24/05/2015
  Features
    # [Bug 25871] %file()% - insert html, text or image from file (for customized signatures)
                  use a local file path in order to insert a file from the computer you are sending from
                  %file(fileName)%
                  %file(fileName,encoding)%
                  If the encoding parameter is omitted, we assume UTF-8 (recommended)
                  %file(imageName,altText)%
                  The optional altText is displayed at the recipient if the image cannot be displayed. It may not contain the characters ,)(><
                  
    # [Bug 25902], [Bug 26020] To support multiple mail addresses with more flexibility
                   bracketMail(arg) - use  within from() to() cc() etc. to "wrap" mail address with non-standard characters
                   bracketName(arg) - same using "name portion"
            usage: bracketMail(startDel;endDel)  startDel = characters before the mail portion 
                                                 endDel = characters after the mail portion
                                                 e.g. bracketMail(";")  not allowed are:  ; , < > ( ) [ ]
                   bracketMail()        =  <mail@domain.com>
                   bracketMail(angle)   =  <mail@domain.com>
                   bracketMail(round)   =  (mail@domain.com)
                   bracketMail(square)  =  [mail@domain.com]
    
  Bugfixes
    # [Bug 25902] %from% and %to% fail if no argument is given - Added Improvements + Stability + better List support
    # [Bug 25903] In address fields Quotation marks are escaped: \"
    # Fixed: Capitalize Names doesn't work if string is quoted. Makes the whole string lowercase.
             Also words with Names in brackets now.
    # Fixed: getSignatureInner inserts "undefined" in Postbox if no signature is defined for current identity.
    # [Bug 25951] ST4 not working in SeaMonkey 2.32 - Temporal Deadzone - This was caused by some code changes in the
      Mozilla code base that established different rules for variables declared with "var" causing addons to break
      which have the same variable declared with let or var&let multiple times (in the same scope)
    # [Bug 25976] Reply to List: variables not resolved - Stationery Patch available
    # [Bug 26008] Inserting Template in Postbox may fail with "XPCOMUtils not defined"
    # [Bug 25089] Default forward quote not hidden - in Postbox "Fred wrote:" was not removed in plain text mode.
                  Set extensions.smartTemplate4.plainText.preserveTextNodes = true for roll back to previous behavior
    # [Bug 26013] ST4 picks template from common settings instead of identity (Tb38)
    # [Bug 25911] Spaces in long subject headers [Decoding Problem] - WIP
    # Postbox 4: fixed removal of quote header (author wrote:) which is in a plain <span>

  Version 1.1 - 30/08/2015
  Features  
    # [Bug 26043] Save Template / Load Template feature
    # [Bug 25904] Functions to Modify Mail Headers: To, Cc, Bcc, Subject and Others
    #             %header.set(name,value)%
    #             %header.append(name,value)%
    #             %header.prefix(name,value)%
    #             supported headers: subject, to, from, cc, bcc, reply-to 
    # Removed automatic suppression of "mailTo" links and added an option for activating it
    # Postbox 4 compatibility. Raised minimum Verion for Thunderbird to 9

  Version 1.2.1 - 20/04/2016
    # [Bug 26100] Double brackets not working with %cc(name,bracketMail(angle))%
    # [Bug 26159] %cursor% variable breaks paragraphs style
		# [Bug 26126] Unwanted space added after cursor
		# [Bug 26139] Fix position of warning message for variables not allowed in New Emails 
		# [Bug 26197] Thunderbird 45 - unwanted paragraph after quote header
		
	Version 1.3 - 11/07/2016  
	  # [Bug 26207] Add option to delimit address list with semicolons
		# [Bug 26208] Lastname and Firstname arguments omit part of the name when broken up - WIP
		# [Bug 26257] Default quote header not removed in complex Stationery
		# Force Replacing default quote header in Stationery even if no %quoteHeader% variable is contained
		# [Bug 26215] Bad interaction between SmartTemplates and "When using paragraph format, the enter key creates a new paragraph"
		# [Bug 26209] Add option to wrap name in double quotes if it contains commas - WIP
    # When clicking on a mailto link from a web browser with a given text body, this was overwritten by SmartTemplates
		  new behavior: bypass the SmartTemplates to avoid losing information from the web site. 
		# Added button to visit our Thunderbird Daily Youtube channel
		# Updated outdated links to language libraries from ftp to https
		# Release Video at: https://www.youtube.com/watch?v=xKh7FkU8A1w
	
	Version 1.3.1 - 23/09/2016
	  # [Bug 26261] Quote header not inserted in plain text mode
		# [Bug 26260] Browser's "EMail Link" feature doesn't copy link
		
		
  Version 1.4 - 22/01/2017
		# Postbox 5.0 compatibility
	  # Fixed: mailto links are missing signature
		# Extended %matchTextFromBody( )% function
		# New %matchTextFromSubject( )% function
		# Release video at: https://www.youtube.com/watch?v=u72yHAPNkZE
		
  Version 1.5 - 27/04/2018
	  # [Bug 26340] New "unmodified field" option for %To()%, %CC()% and %From()% %from(initial)% New initial keyword to avoid any changes of header; just displays the header as received.
	  # New: %header.set.matchFromSubject()% function to retrieve regex from subject line and set a (text) header
	  # New: %header.append.matchFromSubject()% function to retrieve regex from subject line and append to a (text) header
	  # New: %header.prefix.matchFromSubject()% function to retrieve regex from subject line and prefix to a (text) header
	  # New: %header.set.matchFromBody()% function to retrieve regex from email body and set a (text) header
	  # New: %header.append.matchFromBody()% function to retrieve regex from email body and append to a (text) header
	  # New: %header.prefix.matchFromBody()% function to retrieve regex from email body and prefix to a (text) header
		# New: %to(initial)% keyword to return unchanged address header
		# Fix: [Bug 25571] "replace line breaks with <br>" on when not enabled in Common settings
		# [Bug 26300] %cursor% leaves an unnecessary space character
    # [Bug 26345] Unexpected "Â" character in mail body
		# [Bug 26356] Thunderbird 52 - Forwarding an email inline adds empty paragraph on top
		# [Bug 26364] Inline Images are not shown
		# [Bug 26494] ESR 2018 readiness - Make SmartTemplates compatible with Tb 60
		# [Bug 26446] Thunderbird 57 hangs on start with SmartTemplates enabled 
		# [Bug 26483] Opening an .eml file SmartTemplates doesn't apply templates
		# Adding SmartTemplates Pro License
		# Thunderbird 57 deprecated nsILocaleService causing local date to fail
		# Thunderbird 57 deprecated nsIScriptableDateFormat causing most date functions (datelocal, dateshort) to dail [prTime2Str()]
		# Remember expanded / contracted status of setting dialog 
		# Close settings dialog when clicking on links in the support tab		
		
	Version 1.5.1 - 03/05/2018
	  # changed license to (CC BY-ND 4.0)
	  # [Bug 26518] Clicking on variables in the Variables Tab doesn't copy them
		# [Bug 26434] Forwarding email with embedded images removes images
		              (use insertFileLink? getFileAsDataURI? encodeURIComponent?)
									MsgComposeCommands uses loadBlockedImage() ?
	  # [Bug 26307] Extend dates variables with additional offset parameter for hours / minutes
		# [Bug 26465] Composer does not focus into body of mail
		
	Version 2.0 - 23/12/2018
		# [Bug 26494] ESR 2018 readiness - Make SmartTemplates compatible with Tb 60
	  # [Bug 26523] Remove extra <br> before blockquote if standard quote header is used.
		# [Bug 26524] %datelocal% and %dateshort% are broken in Tb 60
		# Completed various translations (ru, pl, nl, sr)
		# [Bug 26526] %file% causes rogue errors "The Variable %5C.. can not be used for new messages" when including images
		# [Bug 26551] Add Domain License key support for SmartTemplates Pro
		# [Bug 26552] %attach% Variable for attaching [pdf] files
		# Moved links from addons.mozilla.org to addons.thunderbird.net
		# Address Book: Added feature to replace firstname with Display Name if no first name is recorded.
		# Added Indonesian Locale - thanks to Mienz Louveinski (Babelzilla.org)
		# [Bug 26596] Make extracting Name from (parentheses) optional - extensions.smartTemplate4.names.guessFromMail
		# [Bug 26595] Option to disable guessing Name Part
		# [Bug 26597] Add ?? operator to make parts of address header arguments optional, e.g. %from(name,??mail)%
		# Added option for default address variable format
		# [Bug 24993]</a> Premium Feature: Added support for using the following fields when composing a *new* Email:%subject% %from% %to% %cc% %bcc% %date% %dateformat()%
		
	Version 2.1 - 28/07/2019
	  # [Bug 26536] Support using SmartTemplates variables in Thunderbird Templates (Tb 60)
		# [Bug 26634] header.*.matchFrom* functions: append/prepend arbitrary text to field based on match.
		# [Bug 26677] %header.set.matchFromBody()% improvements for use with subject line.
		# [Bug 26629] %X:=timezone()% switch to set a specific time zone with date variables
		# [Bug 26626] "Edit As New" duplicates email content unless Stationery is installed
		# [Bug 26627] Signature was always removed when creating message from templates.
		# [Bug 26628] %dateshort% and %datelocal% omit time portion
		# [Bug 26632] Using %dateformat% in reply / forward: deferred fields are not automatically tidied up
		# [Bug 26635] Cursor when writing/forwarding not placed in "To:" Row 
		# %attach% command defaults to only append HTML files - should accept all file types.
		# Removed display of donate page on update.
		# Remember path for file picker when saving / loading templates
		# [Bug 26667] ESR 2019 Readyness - make SmartTemplates compatible with Thunderbird 68
		# Added mandatory Standard license	

	Version 2.1.1 - 03/08/2019
		# Some improvements with panel sizing on preferences dialog
	  # Added Support Tab (licensed users only - these can now send an email directly) 
		# ESR - Eliminated getCharPref / setCharPref
		# in Tb 68, some account specific options (use HTML, replace BR) are greyed out 
		  when opening the dialog and  have to be reactivated by enabling / disabling 
			"Apply the following template"

	Version 2.2.2 - 13/08/2019
	  # [issue #5] 2.2.2 - Fixed %timezone% to subtract the offset hours rather than falsely add it.
		  also added CEDT and MESZ
		  https://github.com/RealRaven2000/SmartTemplate4/issues/4
		# [issue #4] Fixed locale problem. SmartTemplates due to a regression in 2.0 the current
		  locale of the mail client cannot be determind currectly.
			The %language()% switch works now better and gives more precise error messages
			in JavaScript console where needed.			
		# [issue #3] added formatting 2-digit switches (about:config) for %dateshort% and %datelocal%
		  dateformat.hour, dateformat.day, dateformat.month, dateformat.years
			(change strings from "numeric" to "2-digit")
		# [Bug 26688] Multiple %matchTextFromBody% in a line yielded only a single result
		# Backwards fixes for Thunderbird 52
		# Extended trial period from 14 days to 28 days.
		# Support using %X:=sent% modifier with %dateformat()% function when replying to / forwarding emails. 
		
	Version 2.3 - 16/09/2019
	  # [Bug 26689] Support setting priority with %header.set(priority,value)%
		# [issue 9] %header.set(from)% not working in Tb60.9
	  # Add file template function and management functions
		
	Version 2.3.1 - 20/09/2019		
	  # Improved handling of non-working Stationery Add-on in Thunderbird 68.
		# [issue 14] If Lightning is not installed in Thunderbird 68, the new "file templates" 
		  function will not load the template
		# [issue 15] file templates only work on an account if the box "Apply following template" 
		  is active

	Version 2.4.1 - 20/10/2019
    # [issue 16] in some cases, images in signature trigger the "blocked file" warning
      Improved image replacement with %file()% in signatures.
    # [issue 17] Add switch for Dictionary to change to a different language %spellcheck()%
    # [issue 19] file templates have unexpected line breaks, and contained images may break
      this can happen if option "replacing line breaks with <br>" is active
    # added count down if trial period is expired
    # fixed an issue with handling missing default identities (licenser would fail silently 
      rather than log an error in JS console)
      
	Version 2.4.2 - 28/10/2019
    # [issue 20] If a template file starts with UTF detection character "missing file" is wrongly displayed
    # Sandboxed Javascript (script blocks enclosed in %{%   %}%) implemented in [Bug 25676]
      stopped working in Thunderbird 68, due to the call to Cu.nukeSandbox failing... 
      for now, SmartTemplates allows using these again for versions smaller than 69
      
		
	Version 2.5 - 11/11/2019
    # Added switch for toggling automatic proofing; %spellcheck(off)% to disable, %spellcheck(on)% to enable
      To force switching and change to a different language do the toggle command first.
    # [issue 21] %spellcheck% sometimes doesn't remove red proofing lines after setting language
    # Improved UI on Template Files page for Stationery users:
      - removed irrelevant Save and Load buttons
      - added a (?) button which links to the Stationery help page
    # Completed some of the missing translations for new functionality in the Finnish, French, Czech, 
      Spanish, Italian, Polish and Swedish locales.
    # Extended error log for trouble shooting getFileAsDataURI
  
  
	Version 2.5.1 - 21/11/2019
    # Fix "cut off descriptions" bug in Linux 
    # Added "Silent updates" option
      
	Version 2.5.2 - 21/11/2019
    # [issue 22] Cannot add new recipients to address widget after modifiction through header.set
    # [issue 23] Settings dialog broken in Czech version. 
    

  Version 2.6 - 29/11/2019
    # [issue 7] Losing all text in compose window when changing identity / signature not updated correctly

    
  Version 2.7 - 09/01/2020
    # [issue 25] Set variables from addressbook fields
    # [issue 29] Add configuration item to file template menus.
    # Added an optional 3rd parameter to %matchTextFromBody()% - insert string when no match is found
    
  Version 2.8 - 24/01/2019
    # [issue 31] New functions to remove text / tags from quoted parts
    # The template editor boxes now resize vertically with dialog for easier editing
    # new variable for including mailto body text in template
    # Variables window: Added documentation for address book functions window and slightly modernised layout.
    # [issue 35] extended %identity% with the variable 'addressbook' in order to pull extended info
      from the AB based on an email match
    # completed translations for locales: cs, es-ES, fi, it, pl,pt-BR, ru, sl, sv-SE
    # added international examples for %dateformat% in the variables tab
    
    # [issue 32] Fixed: Single Message window header buttons missing file template dropdowns
    # [Bug 26755],[issue 30] reply button has no template list if reply add is enabled by default.
    # when AB replacement is enabled, allow displayname to be a single word.
    # [issue 38] Images with encoded file URLs are not loaded correctly
    
  Version 2.9 - 11/02/2020
    # [issue 45] Support using %file()% with relative paths and nesting %file()% within a template.
    # [issue 48] Support [[optional double brackets]] syntax for all extended address book fields
    # Remember the last path separately for opening templates from the menu directly
    --
    # [issue 41] No file template menus in single message window
    # [issue 42] The (lastname) switch uses first name from AB if only single name is matched from received address.
    # [issue 43] %file(template)% doesn't work on Mac for paths that start with "/user". 
    # Fixed: Do not run cleanupDeferredFields() on quoted elements
    # Remove double quote from alt attribute in %file(image,alttext)%
    # [issue 46] In Thunderbird 60, mixed Stationery / SmartTemplate, external html file items added by SmartTemplates do not work. 
    
  Version 2.9.1 - 14/02/2020
    # since v2.9: template may not work if signature path is invalid  
    
  Version 2.10.1 - 14/04/2020
    # [issue 59] supports image tags with relative location
    # [issue 56] Support including external style sheet with %style()%
    # [issue 51] Fixed: Outgoing SMTP always using DEFAULT account.
    # [issue 54] Remove unwanted empty lines in reply/forward headers in plain-text emails
    # [issue 55] Added back some of the support for Postbox
    # [issue 58] Guessing firstName is from AB can  lead to last name duplication 

  Version 2.11 - 09/06/2020
    # [issue 60] Fixed difficulties with screenreader navigation in Settings Dialog
    # [issue 24] Allow changing template from Composer screen
    # Completed Serbian Locale  

  Version 2.11.1 - 21/06/2020
    # [issue 64] Regression: external template is removed when changing "from:" address
    # Change Template button - translate to 19 languages.
    # [issue 67] Regression (2.11): License warning screen comes up unexpectedly and number of "To:" rows restricted
    # [issue 68] Regression (2.11): After update SmartTemplates always displays nonlicensed support sites
    
  Version 2.11.2 - 10/07/2020
    # [issue 74] In some cases the menu templates in compact header reply buttons are doubled up
    # [issue 73] Improve Name Capitalization: support double names, such as Klaus-Dieter
    # [issue 75] Clicking %style% from variables tabs inserted %file% instead.
    # [issue 62] reply with template doesn't work from "single message" window 
    
  After release of this version (2.11.2) Thunderbird was forked to support Thunderbird 78.

  ===================


  Version 3.0 (ESR78) - 04/11/2020
    # [issue 69] - Make SmartTemplates compatible with Thunderbird 78 ESR
    #            - Remove Shim Code - this was code for backwards compatibilty with older Thundebrird versions as well as SeaMonkey and Postbox support
    #            - Remove support for SeaMonkey
    #            - Remove Stationery references & configuration
    #            - Rewrote filling in variables and focus method to work with new address widgets
    #            - rewrite all template dropdowns
    
  Version 3.1 - 24/11/2020
    # version bump was necessary after release 2.12.1 for my legacy Thunderbird users (Tb60 and older)    
    # [issue 94] - SmartTemplates does not insert template when Forwarding inline based on an Email written with ST
    # [issue 85] - fixed some dead links linking to old mozdev bugzilla bugs (these are now archived on quickfolders.org)
    # Reenable the sandboxed string script by Benito van der Zander. Set extensions.smartTemplate4.allowScripts = true 
    #   to get them back!
    
  Version 3.2 - 17/12/2020
    # [issue 98] %header.set(to,"[addressee]")% no longer working
    # [pr 97] %conditionalText(forwardMode,"text1","text2")% inserts text based on forwarding inline vs attached
    #         Function added by Artem (conductor111 on github)
    # Some minor improvements in layout for settings dialog and license screen
    # Fixed: Reopening existing tabs on support site did not jump to in page links (such as #donate)
    # Omit update popup for users with licenses > 40days
    # [issue 100] Trial period should restart on license expiry
    # Domain Licenses can now be renewed (and extended 30 days before expiry) directly from the license dialog.
    # Fixed some errors in Serbian and Portuguese help section
    # Fixed reminder for standard license holders using premium functions 
    
  Version 3.3 - 03/01/2020
    # [issue 104] Polish locale crashes settings dialog 
    # [issue 96]  Provide keyboard accelerators for Template picker
    # [issue 102] Fixed: %dateformat()% fails if month name / day name variables are included and %language()% set
    # [issue 61] %quotePlaceholder(level)% new function for including quoted mail within the template for styling
    #             - use the quoteLevel parameter to exclude older quotes from the conversation                  
    # [issue 108] Other Add-ons may accidentally duplicate template if they change the from address in Composer
    # Improved Scrolling behavior if %cursor% is used.
    # Fixed: Resolve Names from AB / Remove email address - this happened even when a "mail" or "bracketMail" parameter is specified
    
  Version 3.3.1 - 04/01/2020
    # [issue 110] Maximize "Account" selector dropdown
    # [issue 112] Tb78: current mail account is not preselected - this worked in Thunderbird 68
    
  Version 3.4.1 - 05/02/2021
    # [issue 91] Improve functions %deleteQuotedText% and %replaceQuotedText% so they can  be used
                 in plain text mode (quote level argument will be ignored)
    # [issue 115] Erratic %datetime()% results when forcing HTML with Shift
    # [issue 71] Added support for setting non-standard header attributes starting with "List" e.g. List-Unsubscribe
    # Improved / fixed warning messages for users with expired licenses 
    # [issue 82] Added a notice about soon-to-expire license in the status bar
    # [issue 117] %header.set(from,"some@address.com")% not working in Thunderbird 78
    # Added examples in variables window for %header.delete(subject)% and %header.set(from)% in 
      (Modify Mail Header) section
    # with option "Remove email address unless format parameter is specified", mail parts such as 
      %from(...,mail)%, %from(...,bracketMail())% were removed
   
  Version 3.4.2 - 06/02/2021 
    # [issue 119] XML Parsing Error settings dialog (it / sv / uk locales)
    # Broken entities in the translations for Italian, Ukrainian and Swedish locale lead to the settings dialog not loading
    # this is caused by google translate injecting double quotes into the strings where it shouldn't have.
    
  Version 3.4.3 - 08/02/2021 
    # Open the license tab when status icon is clicked with expired license to make renewal easier.
    
  Version 3.4.4 - 15/02/2021
    # [issue 120] Spanish locale broken which creates an error when options screen is displayed
    # [issue 121] Common settings are shown even though the correct account seems to be selected!
    
  Version 3.5.1 - 21/05/2021
    # [issue 125] Improved support for converting encoded characters used in address fields such as "from"
    # [issue 126] Enabling Resolve names from Address book falsely disables advanced options
    # [issue 127] Make SmartTemplates compatible with Thunderbird 89 - using notifyTools
    # [issue 130] Error in localization for Traditional Chinese (zh-TW) breaks settings dialog.
    # New localization scheme implemented
    # Added catalan locale (transformed from occitan)
    # fixed openTab in Tb80 (added url parameter)
    
  Version 3.5.3 - 27/05/2021
    # Ongoing work Remove usage of main window instance - for premium feature messages
    # Removed many entries (especially in new Licenser module + background pages) to keep the error console clean 
    # - these are now dependent on debug settings and can be added according to troubleshooting requirements.
    # Added event listener to composer windows so the template menus can be reconfigured in real time.
    # Fixed a regression with links from the Registration dialog caused by the migration to the new licensing modul 
    
  Version 3.5.4 - 03/06/2021
    # New version of WindowListener to support wrench button to access Add-on settings

  Version 3.6 - 17/06/2021
    # [issue 134] Support tab missing in version 3.5.4
    # [issue 137] SmartTemplates doesn't auto-update to 3.5.4 (because it needs permissions?)
    # [issue 135] Expand multiple recipients with %to(firstname)% in New Mail Template.
    # Removed all permissions for accounts, notifications
    
  Version 3.7 - 20/08/2021
    # Make SmartTemplates compatible with Thunderbird 91
    # - removed fixIterator
    # - replaced Array types where necessary
    # - Fixed sliding notifications in composer and icons in all sliding notifications
    # - Fixed about:config dialogs
    # Removed Utilities.openLinkExternally and replaced with messenger.windows.openDefaultBrowser
    # Fixed "Buy License" button at bottom of Settings window
    # Fixed: [issue 143] Template Files - Toolbar buttons missing
    # [issue 118] new variable %clipboard% to insert clipboard contents (will be inserted as HTML)
    # Splash screen: not shown immediately on update; removed message about permissions
    # only show standard license upgrade special offer when within the date

  Version 3.8 - 21/10/2021
    # [issue 142]/[issue 28] Add feature to insert html Smart snippets within Composer
    # [issue 147] Add categories / folders to structure template menus
    # [issue 151] New single variable %recipient% for final recipient to replace %to% / %from% in all templates
    # [issue 148] Regression: Saving / Loading account templates from settings doesn't work without Pro License
    # [issue 139] Double template inserted when replying to own email
    # [issue 149] Fixed: If no %cursor% is entered, HTML template may be truncated / reformatted at the end
    # [issue 153] Fixed: Recipient Names which are only 1 Character long are dropped
    # [issue 156] Fixed: When FORWARDING, %quotePlaceholder% doesn't position forwarded mail text correctly
    # [issue 158] Fixed: Could not switch spell checker language with %spellchecker% command
    # Fixed displaying trial date on license tab
    # Removed "workaround" experimental APIs (notifications, accounts)
    # Removed obsolete "Shim" code

  Version 3.9 - 09/12/2021
    # [issue 164] Feature: Add *selection* placeholder for inserting HTML snippets (fragments)
    # [issue 161] remove text shadow in html edit boxes for dark themes - this makes the text better readable.
    # make sure the Snippets button is being added automatically in Composer {WIP}
    # [issue 162] Fixed: Main toolbar - template dropdowns - items in category submenus don't trigger composer
    # [issue 139] Fixed: Duplicate template inserted when replying to own email - Tb Conversations Add-on!
    # [issue 155] Fixed: reply template applied twice in thunderbird 91.2.0
    # [issue 163] Fixed: With Cardbook installed, SmartTemplates statusbar icon may not be shown
    

  Version 3.10.1 - 04/02/2021
    # [issue 166] %recipient% should use reply-to header if present when replying
    # [issue 150] removed nag screen which pops up after trial date is expired.
    # [issue 154] Support pushing [Esc] to close template change confirmation
    # [issue 167] Address Book list entries are not expanded with empty "To:" address
    # [issue 168] Fixed: custom background and text colors ignored in composer when writing new mails

  Version 3.10.2 - 07/02/2022
    # [issue 170] UI to view license extension longer than 1 month before expiry of Pro license
    # [issue 171] Settings Dialog: Empty Examples tab in Thunderbird 91
    
  Version 3.11 - 17/03/2022
    # [issue 172] Support deleting / replacing text in text of inline forwarded mail
    # [issue 173] Auto-Forward / Auto-Reply with template -  implement triggering template from filter (using FiltaQuilla)
    # [issue 174] %suppressQuoteHeaders% command to suppress all quote headers
    
  Version 3.12.1 - 27/06/2022
    # Compatibility changes for Thunderbird ESR 102:
    #   Fixed notifications
    #   Fixed id  of composer container for setting focus to email
    #   Stabilized code when reading external signatures or including external files
    #   [issue 189] Support multiple spellcheck languages with %spellcheck()%
    #   Fixed menu spacings for Templates in reply / write / forward / Snippets buttons.
    #   
    # [issue 182] Improve *selection* placeholder in Snippets to better support non-text nodes
    # [issue 183] Support using "clipboard" as argument for text and header manipulation functions
    # [issue 185] Simplify Settings - Accounts dropdown and toolbar buttons
    # [issue 187] Support transferring headers / variable results to clipboard
    # [issue 186] Various Issues in bracketMail parameter in %to% / %from% etc.
    # Fix xhtml attribute syntax (no spaces allowed in "attribute=value")
    # Moved clipboard reading to Util module
    # [issue 184] WIP: Move template processing into background script

  Version 3.12.2 - 29/06/2022
    # [issue 197] - Expand / collapse / help buttons invisible when opening settings from Add-ons Manager
    # [issue 198] - Renew license button on lower left of settings dialog not working
    
  Version 3.13 - 21/08/2022
    # [issue 199] Inserting of addresses with display name that contains comma fails with unexpected results
    # [issue 200] bracketMail() and bracketName() cannot be used in the same format string
    # [issue 205] After FiltaQuilla filter forwards / replies with template, the next manual reply uses same template
    # [issue 204] "Update and replace with content" command doesn't replace the field
    # Use compose-window-init event in 102 to attain headers at an earlier stage - to call SmartTemplate4.getHeadersAsync()
    # toclipboard - new parameter for copying address variables to clipboard 
    # bracketMail() / bracketName() Fixed copying angled brackets to clipboard as plain text (and not encoded)
    # [issue 206] %datelocal% throws an error and returns a blank space.
    # [issue 208] Improve accessibility for settings dialog
    # [issue 209] Support license validation with Exchange accounts (from Tb 102)
    # After updating, do not open tab with version log automatically. Old behavior can be restored on the licenses tab.
    # Repaired icon in customize toolbar
    
  Version 3.14 - 26/10/2022
    # [issue 211] accept mixed case headers such as "Newsgroups" / "Message-Id" again
    # [issue 210] support using toclipboard parameter multiple times in the same template
    # [issue 215] Search box in variables window
    # Fixed text colors in Variables window when using dark themes.
    # Known issue - [external?] template not applied when replying to a message we sent ourselves 
    #               that used SmartTemplates - and Tb changes the recipient - 
    #               this leads to immediate secondary loadIdentity(startup=false,...) where previous body 
    #               already has the smartTemplateInserted attribute.
    
  Version 3.15 - 25/11/2022
    # [issue 215] Improved Variables search - use Shift+F3 to search backwards; support Numpad Enter
    # [issue 217] addressbook switches broken.
    
  Version 3.15.1 - 28/11/2022
    # fixed [F3] Search again.
    
  Version 3.16 - 05/03/2023
    # [issue 222] Template Categories containing space characters disrupt the template menus
    # [issue 223] Spellchecker is not activated by %spellcheck()% command - if the option 
                  "spellcheck as you type" is disabled in Composition settings.
    # [issue 219] Regression: bracketName(";") parameter broken. 
    # minimum version: 91.0
    # compatibilty until: 110.0
    # Removed Service wrappers for nsIWindowMediator, nsIWindowWatcher, nsIPromptService, nsIPrefBranch, nsIPrefService, 
    #                              nsIStringBundleService, nsIXULAppInfo, nsIMsgComposeService, nsIConsoleService, nsIVersionComparator,
    #                              nsIXULRuntime
    # [issue 50] Add CardBook support [WIP]
    # [issue 226] Automatically update deferred fields for headers that have been modified / set by template (header.set)
    # use ical.js library to parse various vCard formats
    # (see https://webextension-api.thunderbird.net/en/stable/how-to/contacts.html)
    # Show license buttons on the "menu restrictions" dialog message

  Version 3.16.1 - 21/03/2023
    # [issue 231] Forward with Template doesn't send off mail automatically any more
    # [issue 229] Fixed Scripts fields %{% %}% 
    # [issue 230] %from(addressbook,nickname)% throws an error when trying to use CardBook

  Version 3.17 - 04/05/2023
    # [issue 236] Remove body of forwarded mail - %deleteForwardedBody%
    # [issue 237] Allow %file()% command to use ../ to access parent folders of a file
    # [issue 238] Insert Snippet: support inserting contents of a CSS file as style block
    # [issue 233] Improvements in Template Manager: Category prefix, [TO DO: add sorting]
    # To encourage license renewals: Show bargain section in splash screen if <=10 days to expiry
    # [issue 232] Added pricing section to licensing dialog
    # Added Czech translation to licensing dialog
    # [issue 234] Correct the Number of days left in license by rounding up
    # do not trigger "news" unless min ver changes at least.
    #

  Version 3.17.1 - 16/07/2023
    # [issue 240] Regression (3.16) invalid HTML signature path can lead to problems in template 
    # [issue 242] Update "# licensed days left" at midnight.
    # [issue 244] Allow replaceText and deleteText to affect html that was imported using %file()%
  
<== last version for Thunderbird 102 (previous ESR)  
